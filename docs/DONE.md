
# Funcionalidades Implementadas (DONE)

Este documento registra las características y tareas que ya se han completado en el proyecto Pizzería Serranillo.

## Funcionalidades Implementadas
- **Menú Interactivo de Productos:**
    - [x] Visualización de productos por categorías (Pizzas, Acompañamientos, Bebidas, Postres).
    - [x] Tarjetas de producto con nombre, descripción, precio e imagen.
    - [x] **Información de Alérgenos:**
        - [x] Definición de tipos y datos de alérgenos (`src/lib/types.ts`, `src/data/allergens.ts`).
        - [x] Datos de productos (`src/data/products.ts`) incluyen alérgenos.
        - [x] Visualización de alérgenos (como badges con tooltips) en las tarjetas de producto (`ProductCard.tsx`).
    - [x] Datos de productos cargados desde un archivo estático (`src/data/products.ts`) para importación/sincronización inicial.
    - [x] Productos ahora cargados desde Firestore en la página principal.
- **Carrito de Compras:**
    - [x] Añadir productos al carrito desde las tarjetas de producto.
    - [x] Modal de personalización para pizzas para seleccionar ingredientes extra (con coste adicional).
    - [x] Sidebar del carrito para ver los artículos añadidos, incluyendo detalles de extras.
    - [x] Actualizar cantidad de artículos en el carrito (manejo de ítems únicos por producto + combinación de extras).
    - [x] Eliminar artículos del carrito.
    - [x] Limpiar todo el carrito.
    - [x] Cálculo en tiempo real del subtotal y número total de artículos (considerando precio de extras).
    - [x] Persistencia del carrito entre sesiones utilizando Local Storage.
    - [x] Botón para abrir/cerrar el carrito en la cabecera.
    - [x] **Mejoras UI/UX en el carrito:**
        - [x] Corregido icono de cierre duplicado.
        - [x] Mejorado espaciado y legibilidad de textos e ítems.
        - [x] Eliminado toast de "producto añadido" (sidebar es suficiente feedback).
        - [x] Reorganizado footer del carrito para mejor visualización del subtotal.
- **Proceso de Checkout (Integrado con Stripe):**
    - [x] Formulario de checkout para información de contacto y entrega.
    - [x] Validación de campos del formulario usando React Hook Form y Zod.
    - [x] Resumen del pedido en la página de checkout, mostrando ingredientes extra.
    - [x] Creación de sesión de pago con Stripe, enviando precio total con extras y detalles en metadata.
    - [x] Moneda de pago en Stripe configurada a EUR (corregido uso de '$' por '€' en UI).
    - [x] Redirección a la pasarela de pago de Stripe.
    - [x] Páginas de éxito y cancelación de pago.
    - [x] Webhook de Stripe para procesar pedidos completados y guardarlos en Firestore (incluyendo información de ingredientes extra y alérgenos del producto).
    - [x] Limpieza del carrito tras un pago exitoso.
    - [x] Mensaje de "Carrito vacío" en la página de checkout si no hay artículos.
- **Diseño y UI/UX:**
    - [x] Diseño responsivo adaptado a dispositivos móviles, tabletas y escritorio.
    - [x] Interfaz de usuario moderna y atractiva utilizando ShadCN UI components.
    - [x] Estilizado con Tailwind CSS.
    - [x] Uso de iconos de Lucide React.
    - [x] Notificaciones (toasts) para acciones del usuario (ej. pedido realizado, errores de autenticación).
    - [x] Paleta de colores y tipografía consistentes (definidas en `globals.css` y `tailwind.config.ts`).
    - [x] Componente de cabecera (Header) con logo ("Pizzería Serranillo - Horno de Leña") y acceso al carrito.
    - [x] Componente de pie de página (Footer) con información completa del negocio (dirección, teléfonos, Facebook, IVA, copyright).
    - [x] Sección de horario de apertura en la página de inicio.
    - [x] Reordenamiento de pestañas en perfil de cliente y panel de admin para mejor UX.
    - [x] Estados de pedido con colores distintivos en perfil de cliente.
    - [x] Textos de la interfaz de cliente mayormente en español.
    - [x] Traducción de estados de pedido para la interfaz de usuario (ej. "Pending" -> "Pendiente").
    - [x] Eliminación del estado de pedido "Shipped" para simplificar.
- **Estructura del Proyecto y Configuración:**
    - [x] Proyecto Next.js configurado con App Router.
    - [x] Uso de TypeScript.
    - [x] Estructura de carpetas organizada para componentes, contexto, datos, hooks, etc. (incluye `availableExtras.ts`, `allergens.ts` y `CustomizePizzaDialog.tsx`).
    - [x] Configuración inicial de Genkit (preparado para funcionalidades de IA).
    - [x] Configuración de ESLint y Prettier (asumido por Next.js y buenas prácticas).
    - [x] `next.config.ts` configurado para imágenes (incluyendo `firebasestorage.googleapis.com`) y para ignorar errores de build de TS/ESLint temporalmente.
- **Autenticación de Usuarios (Firebase Auth):**
    - [x] Integración con Firebase Authentication (Email/Password, Google).
    - [x] Configuración de inicialización de Firebase (`src/lib/firebase.ts`).
    - [x] `AuthContext` para gestionar estado de usuario y perfil de Firestore.
    - [x] Páginas de Login, Signup y Forgot Password.
    - [x] Creación/Actualización de perfiles de usuario en Firestore (colección `users`).
    - [x] Manejo de errores y notificaciones (toasts) para operaciones de autenticación.
    - [x] Protección de rutas (`/profile`, `/checkout`, `/admin`) y redirecciones.
    - [x] Funcionalidad de "Olvidé mi contraseña".
    - [x] Funcionalidad de "Cambiar Contraseña" desde el perfil.
    - [x] Envío de correo de verificación al registrarse y opción de reenvío.
    - [x] Visualización de estado de verificación en perfil.
- **Perfil de Usuario:**
    - [x] Página de perfil (`/profile`) para ver información del usuario y de Firebase Auth.
    - [x] Corrección de errores de renderizado y análisis en la página de perfil.
    - [x] Visualización del historial de pedidos del usuario desde Firestore (con actualizaciones en tiempo real y toasts de notificación de cambio de estado).
    - [x] Edición de nombre, dirección de envío predeterminada.
    - [x] Ocultar UID de la vista del cliente.
- **Panel de Administración (`/admin`):**
    - [x] Ruta `/admin` protegida por rol 'admin' (definido en perfil de usuario en Firestore).
    - [x] Enlace condicional al panel de admin en el Header.
    - [x] **Gestión de Productos (CRUD completo, incluyendo selección de alérgenos).**
        - [x] Checkboxes para seleccionar alérgenos de una lista.
        - [x] Preselección de alérgenos comunes para pizzas nuevas.
        - [x] Sincronización de menú desde archivo `products.ts` que actualiza/añade productos y alérgenos, protegiendo imágenes existentes.
    - [x] Visualización y gestión de pedidos recibidos (cambio de estado).
    - [x] Eliminación del estado de pedido 'Shipped' y traducción visual de otros estados en el panel.
    - [x] Visualización y gestión de roles de usuarios.
    - [x] **Corrección de errores de validación HTML en diálogo de sincronización de menú.**
- **Documentación Inicial:**
    - [x] `README.md` básico explicando el proyecto. (Actualizado a versión más detallada)
    - [x] Creación de archivos de planificación del proyecto: `docs/TODO.md`, `docs/DONE.md`, `docs/ARCHITECTURE.md`, `docs/BUGS.md`. (Actualizados)
- **PWA (Progressive Web App):**
    - [x] Añadido `next-pwa` y configuración básica.
    - [x] Creado `manifest.json`.
    - [x] Enlaces y metadatos en `layout.tsx`. (Iconos deben ser creados manualmente por el usuario).
- **Seguimiento de Pedidos Simplificado:**
    - [x] El administrador puede iniciar/detener el envío de coordenadas GPS para un pedido marcado como "En Reparto" ("Out for Delivery").
    - [x] El cliente puede ver la ubicación del repartidor en un mapa en su página de perfil si el pedido está "En Reparto" (funcionalidad de mapa corregida).

Esta lista se actualizará a medida que se completen más tareas del archivo `TODO.md`.
